

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>1.3. Galera Replication Architecture &mdash; galera 1.0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="galera 1.0.1 documentation" href="index.html" />
    <link rel="up" title="1. Galera Technical Description" href="technicaldescription.html" />
    <link rel="next" title="1.4. Certification Based Replication" href="certificationbasedreplication.html" />
    <link rel="prev" title="1.2. Galera Cluster Deployment Variants" href="deploymentvariants.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="certificationbasedreplication.html" title="1.4. Certification Based Replication"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="deploymentvariants.html" title="1.2. Galera Cluster Deployment Variants"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">galera 1.0.1 documentation</a> &raquo;</li>
          <li><a href="technicaldescription.html" accesskey="U">1. Galera Technical Description</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="galera-replication-architecture">
<h1>1.3. Galera Replication Architecture<a class="headerlink" href="#galera-replication-architecture" title="Permalink to this headline">¶</a></h1>
<p id="id1">As we learned in the introduction, synchronous replication
uses eager replication, where the nodes keep all other nodes
synchronized by updating all replicas in a single transaction.
In other words, when a transaction commits, all nodes have the
same value. This takes place by using writeset replication
over group communication.</p>
<p>The Galera replication architecture software entities are</p>
<ul class="simple">
<li><em>DBMS</em>—A Database Management System (DBMS), such as MySQL.</li>
<li><em>wsrep API</em>—The wsrep API defines the interface and the
responsibilities for the DBMS and replication provider. The
wsrep API consists of:<ul>
<li><em>wsrep hooks</em>—The wsrep integration in the DBMS engine.</li>
<li><em>dlopen</em>—The <tt class="docutils literal"><span class="pre">dlopen()</span></tt> function makes the wsrep
provider available to <em>wsrep hooks</em>.</li>
</ul>
</li>
<li><em>Galera plugin</em>—The Galera plugin implements the
synchronous replication between the datavase nodes. The
Galera plugin consists of:<ul>
<li><em>Galera wsrep provider</em> implements the wsrep API for the Galera
plugin.</li>
<li><em>Certification layer</em>—The certification layer prepares
the write sets and performs the certification.</li>
<li><em>Replication layer</em>—The replication layer manages the
replication protocol and provides the total ordering
capability.</li>
<li><em>Group communication framework</em>—The group communication
framework provides a plugin architecture for various group
communication systems.</li>
</ul>
</li>
<li><em>Group communication plugins</em>—Galera can use various
group communication systems. We have used, for example,
Spread (<a class="reference external" href="http://www.spread.org/">http://www.spread.org/</a>) and our own implementations,
such as <em>vsbes</em> and <em>gemini</em>.</li>
</ul>
<p>The entities above are depicted in the figure below and explained
in more detail in the chapters below:</p>
<div class="figure">
<img alt="_images/galeralibrary.png" src="_images/galeralibrary.png" />
<p class="caption"><em>Galera Replication Architecture</em></p>
</div>
<div class="section" id="database-management-system">
<h2>1.3.1. Database Management System<a class="headerlink" href="#database-management-system" title="Permalink to this headline">¶</a></h2>
<p id="id2">Galera supports the following database management systems:</p>
<ul class="simple">
<li>MySQL</li>
<li>MariaDB</li>
</ul>
</div>
<div class="section" id="wsrep-api">
<h2>1.3.2. wsrep API<a class="headerlink" href="#wsrep-api" title="Permalink to this headline">¶</a></h2>
<p id="id3">The <em>wsrep API</em> is a generic replication plugin interface for databases.
The API defines a set of application callbacks and replication
plugin calls.</p>
<p>The <em>wsrep API</em> is used in a replication model where an application, such
as a database server, has a state. In practice, the state refers to the
contents of the database. When the database is used, clients modify the
database contents and the database state changes. This changing of the
state is represented as a series of atomic changes (transactions). In
a database cluster, all nodes always have the same state, which they
synchronize with each other by replicating and applying state changes
in the same serial order.</p>
<p>From a more technical perspective, the state change process is
as follows:</p>
<ol class="arabic simple">
<li>A state change takes place on the database.</li>
<li>The <em>wsrep hooks</em> within the database populate the write sets
for the other database nodes in the cluster.</li>
<li>The <em>wsrep hooks</em> call the <em>Galera wsrep provider</em> through the
<tt class="docutils literal"><span class="pre">dlopen()</span></tt> function.</li>
<li>The Galera plugin handles the writeset certification and
replication to the other database nodes in the cluster.</li>
</ol>
<p>At the receiving end, the application process takes place by high
priority transaction(s).</p>
<p>To keep the state identical on all nodes, the wsrep API uses a global
transaction ID (GTID), which is used to both:</p>
<ul class="simple">
<li>Identify the state change</li>
<li>Identify the state itself by the ID of the last state change</li>
</ul>
<p>The GTID consists of:</p>
<ul class="simple">
<li>A state UUID, which uniquely identifies the state and the
sequence of changes it undergoes</li>
<li>An ordinal sequence number (seqno, a 64-bit signed integer)
to denote the position of the change in the sequence</li>
</ul>
<p>By using the GTID, you can</p>
<ul class="simple">
<li>Compare the application states</li>
<li>Establish the order of state changes</li>
<li>Determine whether the change was applied or not</li>
<li>Whether the change is applicable at all to a given state (in
short, whether it is all-powerful)</li>
</ul>
<p>In a human-readable format, the GTID might look like this:</p>
<div class="highlight-python"><pre>45eec521-2f34-11e0-0800-2a36050b826b:94530586304</pre>
</div>
</div>
<div class="section" id="galera-plugin">
<h2>1.3.3. Galera Plugin<a class="headerlink" href="#galera-plugin" title="Permalink to this headline">¶</a></h2>
<p id="id4">The Galera plugin components are described in the chapters below.</p>
<div class="section" id="galera-wsrep-provider">
<h3>1.3.3.1. Galera wsrep Provider<a class="headerlink" href="#galera-wsrep-provider" title="Permalink to this headline">¶</a></h3>
<p><em>Galera wsrep provider</em> implements the <em>wsrep API</em> within the Galera plugin.</p>
</div>
<div class="section" id="certification-layer">
<h3>1.3.3.2. Certification Layer<a class="headerlink" href="#certification-layer" title="Permalink to this headline">¶</a></h3>
<p>The certification layer prepares the write sets. The write
sets can carry original <abbr title="Structured Query Language">SQL</abbr>
statements or, for best performance,
row based replication events (available in MySQL 5.1 and onwards).</p>
<p>Furthermore, the certification layer performs certification
by comparing keys in the write sets. By comparing the keys,
the Galera certification algorithm detects possible conflicts
and can roll back victim transactions, if any. This improves
the efficiency of multi-master replication.</p>
<p>The certification layer guarantees that all cluster nodes can
concurrently modify the same table and still stay consistent.
As a result, no master failovers are required and there is no
single point of failure in the cluster.</p>
</div>
<div class="section" id="replication-layer">
<h3>1.3.3.3. Replication Layer<a class="headerlink" href="#replication-layer" title="Permalink to this headline">¶</a></h3>
<p>The replication layer manages the replication protocol and
provides the total ordering capability, that is, defines the
order of committing transactions in the cluster.</p>
<p>The replication layer lets the actual SQL statement processing
happen uninterrupted, resembling the native MySQL method. This
makes client interaction with the cluster fast and, for the
application, the Galera cluster appears like any native MySQL
server. The only difference is commit processing, where a certain
delay is caused by synchronization with the cluster.</p>
</div>
<div class="section" id="group-communication-framework">
<h3>1.3.3.4. Group Communication Framework<a class="headerlink" href="#group-communication-framework" title="Permalink to this headline">¶</a></h3>
<p>The group communication framework provides a plugin
architecture for various group communication systems.</p>
<p>The Galera cluster is built on top of a proprietary
group communication system layer which implements
virtual synchrony <abbr title="Quality of Service">QoS</abbr>. Virtual
synchrony unifies the data delivery and cluster membership
service, which provides clear formalism for message
delivery semantics.</p>
<p>Virtual Synchrony guarantees consistency, but not temporal
synchrony, which is required for smooth multi-master
operation. For this purpose, Galera implements its own
runtime-configurable temporal flow control, which keeps
nodes synchronized to a fraction of second.</p>
<p>The group communication framework also provides total
ordering of messages from multiple sources, which is
used to build global transaction IDs in a multi-master
cluster.</p>
<p>At the transport level, Galera cluster is a symmetric
undirected graph, where all database nodes are connected
with each other over a <abbr title="Transmission Control Protocol">TCP</abbr>
connection. By default, TCP
is used for both message replication and the cluster
membership service, but also <abbr title="User Datagram Protocol">UDP</abbr>
multicast can be used for replication in a <abbr title="Local Area Network">LAN</abbr>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">1.3. Galera Replication Architecture</a><ul>
<li><a class="reference internal" href="#database-management-system">1.3.1. Database Management System</a></li>
<li><a class="reference internal" href="#wsrep-api">1.3.2. wsrep API</a></li>
<li><a class="reference internal" href="#galera-plugin">1.3.3. Galera Plugin</a><ul>
<li><a class="reference internal" href="#galera-wsrep-provider">1.3.3.1. Galera wsrep Provider</a></li>
<li><a class="reference internal" href="#certification-layer">1.3.3.2. Certification Layer</a></li>
<li><a class="reference internal" href="#replication-layer">1.3.3.3. Replication Layer</a></li>
<li><a class="reference internal" href="#group-communication-framework">1.3.3.4. Group Communication Framework</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="deploymentvariants.html"
                        title="previous chapter">1.2. Galera Cluster Deployment Variants</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="certificationbasedreplication.html"
                        title="next chapter">1.4. Certification Based Replication</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/architecture.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="certificationbasedreplication.html" title="1.4. Certification Based Replication"
             >next</a> |</li>
        <li class="right" >
          <a href="deploymentvariants.html" title="1.2. Galera Cluster Deployment Variants"
             >previous</a> |</li>
        <li><a href="index.html">galera 1.0.1 documentation</a> &raquo;</li>
          <li><a href="technicaldescription.html" >1. Galera Technical Description</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Tommi Takkunen-Lauri.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>