

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>3.1. Node Provisioning and Recovery &mdash; galera 1.0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="galera 1.0.1 documentation" href="index.html" />
    <link rel="up" title="3. Administration Guide" href="userguide.html" />
    <link rel="next" title="3.2. Resetting the Quorum" href="quorumreset.html" />
    <link rel="prev" title="3. Administration Guide" href="userguide.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="quorumreset.html" title="3.2. Resetting the Quorum"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="userguide.html" title="3. Administration Guide"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">galera 1.0.1 documentation</a> &raquo;</li>
          <li><a href="userguide.html" accesskey="U">3. Administration Guide</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="node-provisioning-and-recovery">
<h1>3.1. Node Provisioning and Recovery<a class="headerlink" href="#node-provisioning-and-recovery" title="Permalink to this headline">¶</a></h1>
<p id="id1">The state of new and failed nodes differs from the state of
the primary component and needs to be synchronized. As a result,
new node provisioning and failed node recovery are essentially
the same process of joining the node to the cluster
<abbr title="Primary Component">PC</abbr>.</p>
<p>The initial node state ID is read from the <em>grastate.txt</em>
file in <tt class="docutils literal"><span class="pre">wsrep_data_dir</span></tt>, where it is saved every time
the node is gracefully shut down. If the node crashes, its
database state is unknown and its initial Galera node state
is undefined (<tt class="docutils literal"><span class="pre">00000000-0000-0000-0000-000000000000:-1</span></tt>).</p>
<p>When a node joins the primary component, it compares its
state ID to that of the <abbr title="Primary Component">PC</abbr> and
if they do not match, the node requests for state transfer
from the cluster.</p>
<p>There are two possibilities to select the state transfer donor:</p>
<ul class="simple">
<li>Automatic—The group communication layer determines
the state donor from the available members of the primary
component.</li>
<li>Manual—The state donor name is specified with the
<tt class="docutils literal"><span class="pre">wsrep_sst_donor</span></tt> parameter on startup.</li>
</ul>
<p>In the latter case, if a node with that name is not a part of
the primary component, state transfer fails and the joining node
aborts. Use the same donor name as set in the <tt class="docutils literal"><span class="pre">wsrep_node_name</span></tt>
parameter on the donor node.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">State transfer is a heavy operation not only on the
joining node, but also on donor. The state donor may
not be able to serve client requests. Thus, when possible,
select the donor manually, based on network proximity.
Configure the load balancer to transfer client connections
to the other nodes for the duration of state transfer.</p>
</div>
<p>During state transfer the joining node caches writesets received
from other nodes in a <em>slave queue</em> and applies them after the
state transfer is over, to catch up with the current primary
component state. Since the state snapshot always has a
state ID, it is easy to determine which writesets are already
contained in the snapshot and should be discarded.</p>
<p>During the catch-up phase, flow control ensures that the slave
queue gets shorter (that is, the cluster replication rate will
be limited to the writeset application rate on the catching node).
However, there is no guarantee on how soon the node will catch up.
When the node catches up, its status becomes <tt class="docutils literal"><span class="pre">SYNCED</span></tt> and
it will accept client connections.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="userguide.html"
                        title="previous chapter">3. Administration Guide</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="quorumreset.html"
                        title="next chapter">3.2. Resetting the Quorum</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/nodeprovisioning.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="quorumreset.html" title="3.2. Resetting the Quorum"
             >next</a> |</li>
        <li class="right" >
          <a href="userguide.html" title="3. Administration Guide"
             >previous</a> |</li>
        <li><a href="index.html">galera 1.0.1 documentation</a> &raquo;</li>
          <li><a href="userguide.html" >3. Administration Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Tommi Takkunen-Lauri.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>